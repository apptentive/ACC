<!DOCTYPE html>
<html ng-app="accApp">
<head>
  <title>Projects list</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-animate.js"></script>
  <script>
    var accApp = angular.module('accApp', []);
    accApp.controller('ProjectCtrl', ['$scope', '$http', '$timeout', function ($scope, $http, $timeout) {
      $scope.projectList = []
      $scope.getAll = function() {
        $http({
          method: 'GET',
          url: '/projects'
        })
        .success(function(response) { $scope.projectList = response })
        .error(function() { console.log("error") });
      }

      $scope.openProject = function(id) {
        $http({
          method: 'GET',
          url: '/projects/' + id
        })
        .success(function(response) { $scope.project = response })
        .error(function() { console.log("error") })
      };

      $scope.deleteProject = function(id) {
        $http({
          method: 'DELETE',
          url: '/projects/' + id
        })
        .success(function(project) { console.log(project) })
        .error(function() { console.log("error") })
      }

      $scope.addProject = function() {
        $http({
          method: 'POST',
          url: '/projects'
        })
        .success(function(project) { console.log(project) })
        .error(function() { console.log("error") })
      }
    }]);
  </script>
</head>
<body ng-controller="ProjectCtrl" >
  <div class="sidebar" ng-init="getAll()">
    <h2>Project list</h2>
    <table class="list">
      <tr ng-repeat="project in projectList">
        <th><a href="" ng-click="openProject(project.id)">{{project.title}}</a></th>
        <td><a href="" ng-click="deleteProject(project.id)">Delete</a></td>
      </tr>
      <tr ng-model="showform">
        <th colspan="2"><a href="" ng-click="showform=true" ng-hide="showform">Add</a></th>
        <tr ng-show="showform">
          <form>
            <td colspan="2">
              New project name: <input type="text"><br>
              <a href="" ng-click="addProject" ng-show="showform">Create Project</a>
            </td>
          </form>
        </tr>
        <tr ng-show="showform">
          <td colspan="2"><a href="" ng-click="showform=false" ng-show="showform">Cancel</a></td>
        </tr>
      </tr>
    </table>
  </div>
  <div class="project" ng-init="openProject()">
    <h1>{{project.title}}</h1>
    <table id="grid">
      <script>
        var grid = "<tr><th>&nbsp</th>"
        grid += "<th ng-repeat=\"attribute in project.attributes\">{{attribute.name}}</th></tr>"
        grid += "<tr ng-repeat=\"component in project.components\"><th>{{component.name}}</th><th ng-repeat=\"attribute in project.attributes\">&nbsp</th></tr>"
        document.getElementById("grid").innerHTML = grid;
      </script>
    </table>
  </div>
</body>
</html>
